<!doctype html>
<html lang="en">

<title>
Pixel Zoomer v1.3.0
</title>

<meta name="description"
content="View pixel art images aligned to physical pixels on any display."
>

<!--
Changelog
v1.3.0 local files on file input (dragNdrop)
v1.2.0 customizable background colour
v1.1.0 UI is zoom - immune 
v1.0.0 zoom it with number input
v0.0.1 paste image and make it match device pixels Ã— 5
Todo
read params - try to load from URL, prompt for copy on CORS fail
persistence (settings)
-->

<meta name="color-scheme" content="dark light">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
 --dpx: calc( 1 / var(--dpr) * 1px );
 /*
  this locks freezes zoom level to fixed stat
  it is normally super evil
  don't do that if you need to remain accessible
 */
 font-size: calc(var(--dpx) * 30);
 margin: 1em;
 & * { font-size: inherit; }
}
img {
 image-rendering: pixelated;
 image-rendering: crisp-edges;
 width: calc( var(--dpx) * var(--width) * var(--scale));
 background-color:var(--background);
}
hr, input { border-width: var(--dpx); }
input[type="color"] { height: 1em; width: 1em; padding: 0; border: none; }
</style>

<body style="
 --background: /* here will be background colour */;
 --scale: /* here will be picture scale */;
 --dpr: /* here will be device pixel ratio */;
">

<p>
<label>
Paste or drop images:
<input
 type=file
 multiple
 accept="image/*"
 onchange="onPaste({files})"
></label>
</p>

<label>
Scale 1 pixel
<input 
 type=number
 value=5
 min=1
 oninput="document.body.style.setProperty('--scale', value)"
 id=i>
times.
</label>

<label>
Background
<input 
 type=color
 value="#666666"
 oninput="document.body.style.setProperty('--background', value)"
 id=b
>.
</label>

<hr id=hr>

<script>
var lastRatio = devicePixelRatio;

document.addEventListener('paste', onPaste);

/** 
 * @param {ClipboardEvent} event
 */
function onPaste (event) {
 console.log(event)
 const files = event?.clipboardData?.items || event?.files;
 if( !files ) {
  return
 }
 for (const file of files) { 
  if (file?.type?.split('/')[0] == 'image') {
   const blob = file.getAsFile ? file.getAsFile() : file;
   const img = new Image();
   img.onload = function(){
    img.style.setProperty( '--width', String(img.width) );
    hr.after(img);
    delete img.onload;
   }
   img.src = URL.createObjectURL(blob);
  }
 }
}

function onresize() {
 const dpr = devicePixelRatio;
 document.body.style.setProperty('--dpr', dpr);
 if(lastRatio == dpr) {
  return;
 }
 if(lastRatio < dpr) {
  i.valueAsNumber += 1;
 } else {
  if(i.valueAsNumber > 1) {
   i.valueAsNumber -= 1;
  }
 }
 i.oninput();
 lastRatio = dpr;
} 
 
onresize();
window.addEventListener('resize', onresize, true);
i.oninput();
b.oninput();
</script>
